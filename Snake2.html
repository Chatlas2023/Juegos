<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Móvil v1.40</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            touch-action: manipulation;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        #game-canvas {
            width: 100%;
            height: auto;
            display: block;
            border: 2px solid #333;
            background-color: #1e1e1e;
            touch-action: none;
        }
        
        /* Resto de tus estilos CSS... */
    </style>
</head>
<body>
    <div class="version">v1.40</div>
    <h1>Snake Móvil</h1>
    <div id="score">Puntuación: 0</div>
    <div id="high-score">Máxima puntuación: 0</div>
    <div id="game-container">
        <canvas id="game-canvas" width="400" height="400"></canvas>
        <div id="game-over">
            <h2>¡Game Over!</h2>
            <div id="final-score">Puntuación: 0</div>
            <div id="final-high-score">Máxima puntuación: 0</div>
            <button class="btn" id="restart-btn">Jugar de nuevo</button>
        </div>
    </div>
    
    <div id="controls">
        <button id="up-btn" class="control-btn">↑</button>
        <button id="left-btn" class="control-btn">←</button>
        <button id="down-btn" class="control-btn">↓</button>
        <button id="right-btn" class="control-btn">→</button>
    </div>

    <script>
        // Esperar a que el DOM esté completamente cargado
        document.addEventListener('DOMContentLoaded', function() {
            // Configuración del juego
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            
            // Asegurarse de que el canvas existe
            if (!canvas || !ctx) {
                console.error('No se pudo obtener el contexto del canvas');
                return;
            }
            
            // Inicializar tamaño del canvas
            function resizeCanvas() {
                const container = document.getElementById('game-container');
                if (!container) return;
                
                const containerWidth = container.clientWidth;
                const canvasSize = Math.min(containerWidth, 400);
                
                canvas.style.width = canvasSize + 'px';
                canvas.style.height = canvasSize + 'px';
                
                // Mantener el buffer interno a 400x400 para una cuadrícula limpia
                canvas.width = 400;
                canvas.height = 400;
                
                console.log('Canvas redimensionado a:', canvas.width, 'x', canvas.height);
            }
            
            // Llamar a resizeCanvas inmediatamente y en cada redimensionamiento
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Constantes del juego
            const GRID_SIZE = 20;
            const GRID_WIDTH = canvas.width / GRID_SIZE;
            const GRID_HEIGHT = canvas.height / GRID_SIZE;
            
            // Estado del juego
            let snake = [{x: 10, y: 10}]; // Posición inicial centrada
            let snakeDirection = {x: 1, y: 0};
            let nextDirection = {x: 1, y: 0};
            let foods = [];
            let score = 0;
            let gameSpeed = 150;
            let gameInterval;
            let gameRunning = false;
            
            // Generar comida
            function generateFood() {
                let newFood;
                let isValidPosition = false;
                let attempts = 0;
                const maxAttempts = 100;
                
                while (!isValidPosition && attempts < maxAttempts) {
                    attempts++;
                    newFood = {
                        x: Math.floor(Math.random() * GRID_WIDTH),
                        y: Math.floor(Math.random() * GRID_HEIGHT)
                    };
                    
                    // Verificar posición
                    const onSnake = snake.some(s => s.x === newFood.x && s.y === newFood.y);
                    const onFood = foods.some(f => f.x === newFood.x && f.y === newFood.y);
                    isValidPosition = !onSnake && !onFood;
                }
                
                return isValidPosition ? newFood : null;
            }
            
            // Inicializar comida
            function initFood() {
                foods = [];
                const food = generateFood();
                if (food) foods.push(food);
                console.log('Comida inicializada:', foods);
            }
            
            // Dibujar el juego
            function draw() {
                console.log('Dibujando juego...');
                
                // Limpiar canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#1e1e1e';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Dibujar serpiente
                ctx.fillStyle = '#4CAF50';
                snake.forEach(segment => {
                    ctx.fillRect(
                        segment.x * GRID_SIZE, 
                        segment.y * GRID_SIZE, 
                        GRID_SIZE - 1, 
                        GRID_SIZE - 1
                    );
                });
                
                // Dibujar comida
                ctx.fillStyle = '#FF5252';
                foods.forEach(food => {
                    if (food) {
                        ctx.beginPath();
                        ctx.arc(
                            food.x * GRID_SIZE + GRID_SIZE/2, 
                            food.y * GRID_SIZE + GRID_SIZE/2, 
                            GRID_SIZE/2 - 1, 
                            0, 
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                });
            }
            
            // Resto de las funciones del juego (update, checkCollisions, gameOver, etc.)
            // ... (mantén el resto de tus funciones igual)
            
            // Función para iniciar el juego
            function startGame() {
                console.log('Iniciando juego...');
                snake = [{x: 10, y: 10}];
                snakeDirection = {x: 1, y: 0};
                nextDirection = {x: 1, y: 0};
                score = 0;
                document.getElementById('score').textContent = `Puntuación: ${score}`;
                document.getElementById('game-over').style.display = 'none';
                
                initFood();
                draw();
                
                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(gameLoop, gameSpeed);
                gameRunning = true;
            }
            
            // Configurar controles
            function setupControls() {
                const controls = {
                    'up-btn': {x: 0, y: -1},
                    'down-btn': {x: 0, y: 1},
                    'left-btn': {x: -1, y: 0},
                    'right-btn': {x: 1, y: 0}
                };
                
                Object.entries(controls).forEach(([id, dir]) => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            if (gameRunning) nextDirection = dir;
                        });
                        btn.addEventListener('touchstart', (e) => {
                            e.preventDefault();
                            if (gameRunning) nextDirection = dir;
                        });
                    }
                });
            }
            
            // Configurar botón de reinicio
            const restartBtn = document.getElementById('restart-btn');
            if (restartBtn) {
                restartBtn.addEventListener('click', startGame);
            }
            
            // Iniciar el juego
            setupControls();
            startGame();
        });
    </script>
</body>
</html>
