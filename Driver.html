<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Night Driver Mobile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        #score-board {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: #222;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            z-index: 10;
        }
        
        #game-canvas {
            flex-grow: 1;
            background-color: #000;
            width: 100%;
            image-rendering: pixelated;
        }
        
        #controls {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background-color: #222;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #444;
            border: 2px solid #666;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            user-select: none;
        }
        
        #left-btn {
            margin-right: 10px;
        }
        
        #right-btn {
            margin-left: 10px;
        }
        
        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }
        
        .menu-title {
            font-size: 36px;
            color: #ff0;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0;
            font-family: 'Arial Black', sans-serif;
        }
        
        .menu-item {
            font-size: 24px;
            margin: 15px 0;
            padding: 10px 20px;
            background-color: #333;
            border: 2px solid #666;
            border-radius: 10px;
            width: 80%;
            text-align: center;
            cursor: pointer;
        }
        
        .menu-item:active {
            background-color: #555;
        }
        
        #level-info {
            font-size: 20px;
            margin-top: 20px;
            color: #0f0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="score-board">
            <div>SCORE <span id="score">000</span></div>
            <div>SPEED <span id="speed">000</span></div>
            <div>TIME <span id="time">000</span></div>
        </div>
        
        <canvas id="game-canvas"></canvas>
        
        <div id="controls">
            <div class="control-btn" id="left-btn">←</div>
            <div class="control-btn" id="brake-btn">BRAKE</div>
            <div class="control-btn" id="right-btn">→</div>
        </div>
        
        <div id="menu-screen">
            <div class="menu-title">NIGHT DRIVER</div>
            <div class="menu-item" id="start-btn">START GAME</div>
            <div class="menu-item" id="level-btn">LEVEL: NOVICE</div>
            <div id="level-info">Use arrows to avoid obstacles</div>
        </div>
    </div>

    <script>
        // Variables del juego
        let score = 0;
        let speed = 0;
        let time = 0;
        let gameRunning = false;
        let currentLevel = 'NOVICE';
        let roadWidth = 100;
        let playerX = 0;
        let obstacles = [];
        let gameInterval;
        
        // Elementos del DOM
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const speedElement = document.getElementById('speed');
        const timeElement = document.getElementById('time');
        const menuScreen = document.getElementById('menu-screen');
        const startBtn = document.getElementById('start-btn');
        const levelBtn = document.getElementById('level-btn');
        const leftBtn = document.getElementById('left-btn');
        const rightBtn = document.getElementById('right-btn');
        const brakeBtn = document.getElementById('brake-btn');
        
        // Ajustar tamaño del canvas
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
            if (gameRunning) {
                drawGame();
            }
        }
        
        // Inicializar el juego
        function initGame() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Event listeners para controles táctiles
            startBtn.addEventListener('click', startGame);
            levelBtn.addEventListener('click', changeLevel);
            
            leftBtn.addEventListener('touchstart', () => moveLeft());
            leftBtn.addEventListener('touchend', () => stopMove());
            
            rightBtn.addEventListener('touchstart', () => moveRight());
            rightBtn.addEventListener('touchend', () => stopMove());
            
            brakeBtn.addEventListener('touchstart', () => brake());
            brakeBtn.addEventListener('touchend', () => releaseBrake());
            
            // Controles de teclado para navegadores de escritorio
            document.addEventListener('keydown', (e) => {
                if (!gameRunning) return;
                
                if (e.key === 'ArrowLeft') {
                    moveLeft();
                } else if (e.key === 'ArrowRight') {
                    moveRight();
                } else if (e.key === 'ArrowDown') {
                    brake();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    stopMove();
                } else if (e.key === 'ArrowDown') {
                    releaseBrake();
                }
            });
            
            drawMenu();
        }
        
        // Dibujar menú principal
        function drawMenu() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // No es necesario dibujar nada aquí porque tenemos el div del menú
        }
        
        // Cambiar nivel de dificultad
        function changeLevel() {
            const levels = ['NOVICE', 'EASY', 'PRO'];
            const currentIndex = levels.indexOf(currentLevel);
            currentLevel = levels[(currentIndex + 1) % levels.length];
            levelBtn.textContent = `LEVEL: ${currentLevel}`;
        }
        
        // Iniciar el juego
        function startGame() {
            menuScreen.style.display = 'none';
            gameRunning = true;
            score = 0;
            speed = 0;
            time = 0;
            playerX = 0;
            obstacles = [];
            
            updateScoreboard();
            
            // Iniciar bucle del juego
            gameInterval = setInterval(() => {
                updateGame();
                drawGame();
            }, 50);
        }
        
        // Actualizar lógica del juego
        function updateGame() {
            // Incrementar tiempo
            time++;
            
            // Aumentar velocidad gradualmente
            if (speed < 35) {
                speed += 0.2;
            }
            
            // Generar obstáculos aleatorios
            if (Math.random() < 0.05) {
                generateObstacle();
            }
            
            // Actualizar posición de obstáculos
            updateObstacles();
            
            // Actualizar marcadores
            updateScoreboard();
        }
        
        // Generar un nuevo obstáculo
        function generateObstacle() {
            const obstacle = {
                x: Math.random() * roadWidth - roadWidth/2,
                y: canvas.height,
                width: 30,
                height: 30,
                type: Math.random() > 0.5 ? 'cone' : 'car'
            };
            obstacles.push(obstacle);
        }
        
        // Actualizar posición de obstáculos
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].y -= speed / 2;
                
                // Detectar colisiones
                if (detectCollision(obstacles[i])) {
                    gameOver();
                    return;
                }
                
                // Eliminar obstáculos que salieron de la pantalla
                if (obstacles[i].y < -30) {
                    obstacles.splice(i, 1);
                    score += 10;
                }
            }
        }
        
        // Detectar colisiones
        function detectCollision(obstacle) {
            // Simplificación: el jugador es un punto en el centro inferior de la pantalla
            const playerCenterX = canvas.width / 2 + playerX;
            const playerY = canvas.height - 50;
            
            return (
                playerCenterX > obstacle.x - obstacle.width/2 &&
                playerCenterX < obstacle.x + obstacle.width/2 &&
                playerY > obstacle.y - obstacle.height/2 &&
                playerY < obstacle.y + obstacle.height/2
            );
        }
        
        // Dibujar el juego
        function drawGame() {
            // Limpiar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Dibujar camino
            drawRoad();
            
            // Dibujar obstáculos
            drawObstacles();
            
            // Dibujar coche del jugador
            drawPlayer();
        }
        
        // Dibujar camino
        function drawRoad() {
            const centerX = canvas.width / 2;
            const perspective = 0.8;
            
            // Dibujar camino
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.moveTo(centerX - roadWidth/2, 0);
            ctx.lineTo(centerX + roadWidth/2, 0);
            ctx.lineTo(centerX + roadWidth/4, canvas.height);
            ctx.lineTo(centerX - roadWidth/4, canvas.height);
            ctx.closePath();
            ctx.fill();
            
            // Dibujar líneas de la carretera
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.setLineDash([20, 20]);
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // Dibujar bordes de la carretera
            ctx.strokeStyle = '#ff0';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(centerX - roadWidth/2, 0);
            ctx.lineTo(centerX - roadWidth/4, canvas.height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX + roadWidth/2, 0);
            ctx.lineTo(centerX + roadWidth/4, canvas.height);
            ctx.stroke();
        }
        
        // Dibujar obstáculos
        function drawObstacles() {
            for (const obstacle of obstacles) {
                const centerX = canvas.width / 2;
                
                if (obstacle.type === 'cone') {
                    // Dibujar cono
                    ctx.fillStyle = '#ff9900';
                    ctx.beginPath();
                    ctx.moveTo(centerX + obstacle.x, obstacle.y);
                    ctx.lineTo(centerX + obstacle.x - 10, obstacle.y + 20);
                    ctx.lineTo(centerX + obstacle.x + 10, obstacle.y + 20);
                    ctx.closePath();
                    ctx.fill();
                } else {
                    // Dibujar coche
                    ctx.fillStyle = '#f00';
                    ctx.fillRect(centerX + obstacle.x - 15, obstacle.y - 10, 30, 20);
                }
            }
        }
        
        // Dibujar jugador
        function drawPlayer() {
            const centerX = canvas.width / 2;
            const playerY = canvas.height - 50;
            
            // Dibujar coche del jugador
            ctx.fillStyle = '#0f0';
            ctx.fillRect(centerX + playerX - 15, playerY - 10, 30, 20);
            
            // Faros
            ctx.fillStyle = '#ff0';
            ctx.beginPath();
            ctx.moveTo(centerX + playerX - 15, playerY - 10);
            ctx.lineTo(centerX + playerX - 20, playerY - 20);
            ctx.lineTo(centerX + playerX - 10, playerY - 10);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(centerX + playerX + 15, playerY - 10);
            ctx.lineTo(centerX + playerX + 20, playerY - 20);
            ctx.lineTo(centerX + playerX + 10, playerY - 10);
            ctx.fill();
        }
        
        // Actualizar marcadores
        function updateScoreboard() {
            scoreElement.textContent = Math.floor(score).toString().padStart(3, '0');
            speedElement.textContent = Math.floor(speed).toString().padStart(3, '0');
            timeElement.textContent = Math.floor(time/20).toString().padStart(3, '0');
        }
        
        // Movimiento a la izquierda
        function moveLeft() {
            playerX = Math.max(playerX - 5, -roadWidth/4 + 15);
        }
        
        // Movimiento a la derecha
        function moveRight() {
            playerX = Math.min(playerX + 5, roadWidth/4 - 15);
        }
        
        // Detener movimiento
        function stopMove() {
            // En esta implementación básica, el coche no tiene inercia
        }
        
        // Frenar
        function brake() {
            speed = Math.max(speed - 1, 0);
        }
        
        // Soltar freno
        function releaseBrake() {
            // No hacer nada especial
        }
        
        // Game over
        function gameOver() {
            clearInterval(gameInterval);
            gameRunning = false;
            
            // Mostrar mensaje de game over
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#f00';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 30);
            
            ctx.fillStyle = '#fff';
            ctx.font = '20px Arial';
            ctx.fillText(`SCORE: ${Math.floor(score).toString().padStart(3, '0')}`, canvas.width / 2, canvas.height / 2 + 20);
            
            // Botón para reiniciar
            ctx.fillStyle = '#0f0';
            ctx.fillRect(canvas.width / 2 - 60, canvas.height / 2 + 50, 120, 40);
            ctx.fillStyle = '#000';
            ctx.font = '18px Arial';
            ctx.fillText('PLAY AGAIN', canvas.width / 2, canvas.height / 2 + 75);
            
            // Esperar a que el usuario toque para reiniciar
            canvas.addEventListener('touchstart', restartOnTouch, { once: true });
        }
        
        // Reiniciar al tocar después de game over
        function restartOnTouch(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.touches[0].clientX - rect.left;
            const y = e.touches[0].clientY - rect.top;
            
            // Comprobar si se tocó el botón de reinicio
            if (x >= canvas.width / 2 - 60 && x <= canvas.width / 2 + 60 &&
                y >= canvas.height / 2 + 50 && y <= canvas.height / 2 + 90) {
                startGame();
            } else {
                // Si no se tocó el botón, volver a esperar
                canvas.addEventListener('touchstart', restartOnTouch, { once: true });
            }
        }
        
        // Inicializar el juego cuando se carga la página
        window.onload = initGame;
    </script>
</body>
</html>
